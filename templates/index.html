<!--templates/index.html-->
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>KTNG GLOBAL TAS - Mini research game</title>

    <!-- Styles -->
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link rel="stylesheet" href="{% static 'custom-confirm-modal.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Profile auth buttons */
        #profile-auth {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }

        .btn-login,
        .btn-logout {
            padding: 8px 14px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-family: inherit;
            transition: background 0.2s ease, transform 0.1s ease;
        }

        .btn-login {
            background: #4CAF50;
            color: #fff;
        }

        .btn-login:hover {
            background: #43a047;
            transform: translateY(-1px);
        }

        .btn-logout {
            background: #e53935;
            color: #fff;
        }

        .btn-logout:hover {
            background: #d32f2f;
            transform: translateY(-1px);
        }

        .profile-guest {
            text-align: center;
            padding: 25px;
        }

        .profile-guest h3 {
            margin-bottom: 15px;
        }

        /* Header controls - only for menu screen */
        .menu-header-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        /* Enhanced Instructions Styles */
        .difficulty-guide {
            margin-top: 20px;
        }

        .difficulty-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .diff-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .diff-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .diff-card h4 {
            margin: 8px 0;
            font-size: 1.1rem;
        }

        .diff-card p {
            font-size: 0.85rem;
            opacity: 0.9;
            margin: 0;
        }

        .instruction-section {
            margin-bottom: 25px;
        }

        .instruction-section h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .instruction-section ul,
        .instruction-section ol {
            margin-left: 20px;
        }

        .instruction-section li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
    </style>
</head>

<body data-theme="light">
{% csrf_token %}
<div id="loading">Loading...</div>

<div id="game-bg"></div>

<!-- ================= INSTRUCTIONS MODAL (UPDATED) ================= -->
<div id="instructions-modal" class="modal-overlay hidden">
    <div class="modal-content instructions-modal">
        <button class="modal-close" onclick="toggleInstructions()">
            <i class="fas fa-times"></i>
        </button>
        <h2><i class="fas fa-gamepad"></i> <span data-i18n="instructions_title">How to Play</span></h2>
        <div class="instructions-content">
            <div class="instruction-section">
                <h3><i class="fas fa-bullseye"></i> <span data-i18n="instructions_objective">Objective</span></h3>
                <p data-i18n="instructions_objective_text">Match text cards with their corresponding fruit cards to earn points and win rewards!</p>
            </div>

            <div class="instruction-section">
                <h3><i class="fas fa-play-circle"></i> <span data-i18n="instructions_howto">How to Play</span></h3>
                <ol>
                    <li data-i18n="instructions_step1">Click on a text card (?) to reveal its description</li>
                    <li data-i18n="instructions_step2">Click on the matching fruit card that fits the description</li>
                    <li data-i18n="instructions_step3">If correct, both cards disappear, you earn points, and new cards appear</li>
                    <li data-i18n="instructions_step4">If wrong, cards reset - but don't worry, no penalty!</li>
                </ol>
            </div>

            <div class="instruction-section">
                <h3><i class="fas fa-trophy"></i> <span data-i18n="instructions_scoring">Scoring System</span></h3>
                <ul>
                    <li><strong data-i18n="level_easy">Easy</strong> (3 min): <span data-i18n="instructions_easy_points">5 points + hints shown + no shuffling</span></li>
                    <li><strong data-i18n="level_medium">Medium</strong> (2.5 min): <span data-i18n="instructions_medium_points">15 points + occasional shuffling</span></li>
                    <li><strong data-i18n="level_hard">Hard</strong> (2 min): <span data-i18n="instructions_hard_points">20 points + frequent shuffling</span></li>
                </ul>
                <p><strong data-i18n="instructions_combo">üî• Combo Bonus:</strong> <span data-i18n="instructions_combo_detail">+2 points for each consecutive match!</span></p>
                <p><strong data-i18n="instructions_time_bonus">‚ö° Time Bonus:</strong> <span data-i18n="instructions_time_bonus_detail">+5 points when you have more than 1 minute left!</span></p>
            </div>

            <div class="instruction-section">
                <h3><i class="fas fa-lightbulb"></i> <span data-i18n="instructions_tips">Pro Tips</span></h3>
                <ul>
                    <li data-i18n="instructions_tip1">üí° Easy mode shows hints - perfect for beginners!</li>
                    <li data-i18n="instructions_tip2">üëÄ Fruit cards are always visible - memorize their positions</li>
                    <li data-i18n="instructions_tip3">üî• Build combos for massive bonus points</li>
                    <li data-i18n="instructions_tip4">‚è∞ No penalties for wrong matches - keep playing!</li>
                    <li data-i18n="instructions_tip5">üéØ Match cards quickly for better scores</li>
                </ul>
            </div>

            <div class="instruction-section difficulty-guide">
                <h3><i class="fas fa-star"></i> <span data-i18n="instructions_difficulty">Choose Your Challenge</span></h3>
                <div class="difficulty-cards">
                    <div class="diff-card">
                        <div class="diff-icon">üå±</div>
                        <h4 data-i18n="level_easy">Easy</h4>
                        <p data-i18n="instructions_easy_desc">Hints visible, more time, no shuffling</p>
                    </div>
                    <div class="diff-card">
                        <div class="diff-icon">‚ö°</div>
                        <h4 data-i18n="level_medium">Medium</h4>
                        <p data-i18n="instructions_medium_desc">Balanced challenge with occasional shuffles</p>
                    </div>
                    <div class="diff-card">
                        <div class="diff-icon">üî•</div>
                        <h4 data-i18n="level_hard">Hard</h4>
                        <p data-i18n="instructions_hard_desc">Maximum points, frequent shuffling</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ================= LOGIN MODAL ================= -->
<div id="login-modal">
    <div class="login-wrapper">
        <div class="login-box">
            <h2 data-i18n="login_title">Enter your details</h2>

            <input type="text"
                   id="login-name"
                   placeholder="Your name"
                   maxlength="100"
                   required>

            <div class="phone-input">
                <span class="prefix">+998</span>
                <input type="tel"
                       id="login-phone"
                       placeholder="901234567"
                       maxlength="9"
                       pattern="\d{9}"
                       required>
            </div>

            <button class="btn-primary" onclick="submitLogin()" data-i18n="login_continue">Continue</button>
        </div>
    </div>
</div>

<!-- ================= APP ================= -->
<div id="app" class="hidden">

    <!-- ============ MENU ============ -->
    <div id="menu-screen" class="screen" data-testid="menu-screen">
        <!-- Header Controls (Only on Menu Screen) -->
        <div class="menu-header-controls">
            <button id="instructions-toggle" class="btn-control" title="Game Instructions" onclick="toggleInstructions()">
                <i class="fas fa-question-circle"></i>
            </button>
            <button id="sound-toggle" class="btn-control" title="Toggle Sound">
                <i class="fas fa-volume-up"></i>
            </button>
            <button id="theme-toggle" class="btn-control" title="Toggle Theme">
                <i class="fas fa-moon"></i>
            </button>
            <button id="lang-toggle" class="btn-control" title="Change Language">
                <span class="btn-lang">EN</span>
            </button>
        </div>

        <h1 class="logo-title">
            <i class=></i> KTNG GLOBAL TAS
        </h1>

        <div class="menu-grid">
            <button class="btn-primary"
                    onclick="showLevelSelect()"
                    data-testid="play-btn">
                <i class="fas fa-play"></i> <span data-i18n="play_game">Play</span>
            </button>

            <button class="btn-icon"
                    onclick="showLeaderboard()"
                    data-testid="leaderboard-btn">
                <i class="fas fa-chart-bar"></i> <span data-i18n="leaderboard">Leaderboard</span>
            </button>

            <button class="btn-icon"
                    onclick="showProfile()"
                    data-testid="profile-btn">
                <i class="fas fa-user"></i> <span data-i18n="profile">Profile</span>
            </button>
        </div>
    </div>

    <!-- ============ LEVELS ============ -->
    <div id="level-screen" class="screen hidden">
        <h2 data-i18n="select_level">Select Difficulty</h2>

        <div class="level-grid">
            <button class="btn-level-large easy" onclick="startGameWithLevel(1)">
                <span data-i18n="level_easy">Easy</span>
                <small>5 Points + Hints</small>
            </button>
            <button class="btn-level-large medium" onclick="startGameWithLevel(2)">
                <span data-i18n="level_medium">Medium</span>
                <small>15 Points + Shuffles</small>
            </button>
            <button class="btn-level-large hard" onclick="startGameWithLevel(3)">
                <span data-i18n="level_hard">Hard</span>
                <small>20 Points + Fast Shuffles</small>
            </button>
        </div>

        <button class="btn-secondary" onclick="showMenu()">
            <i class="fas fa-arrow-left"></i> <span data-i18n="back">Back</span>
        </button>
    </div>

    <!-- ============ GAME ============ -->
    <div id="game-screen" class="screen hidden">
        <!-- HUD at top (compact) -->
        <div id="game-controls-container">
            <div id="hud">
                <div class="hud-box">
                    <span><i class="fas fa-clock"></i> <span data-i18n="time">Time</span></span>
                    <div id="timer-display">00:00</div>
                </div>
                <div class="hud-box">
                    <span><i class="fas fa-star"></i> <span data-i18n="balls">Points</span></span>
                    <div id="score-display">0</div>
                </div>
                <div class="hud-box">
                    <span><i class="fas fa-fire"></i> <span data-i18n="combo">Combo</span></span>
                    <div id="combo-display">0</div>
                </div>
            </div>
        </div>

        <!-- Game board (takes remaining space) -->
        <div id="game-board-container">
            <div id="game-grid" class="cards-grid-large"></div>
        </div>

        <!-- Controls at bottom (footer style) -->
        <div id="bottom-controls">
            <button id="pause-btn" class="btn-game-control" onclick="game.togglePause()">
                <i class="fas fa-pause"></i>
            </button>
            <button class="btn-game-control" onclick="showMenu()">
                <i class="fas fa-home"></i>
            </button>
        </div>
    </div>

    <!-- ============ LEADERBOARD ============ -->
    <div id="leaderboard-screen" class="screen hidden">
        <h2><i class="fas fa-chart-bar"></i> <span data-i18n="leaderboard">Leaderboard</span></h2>
        <div class="scroll-box">
            <ul id="leaderboard-list"></ul>
        </div>
        <button class="btn-secondary" onclick="showMenu()">
            <i class="fas fa-home"></i> <span data-i18n="back">Back</span>
        </button>
    </div>

    <!-- ============ PROFILE (UPDATED) ============ -->
    <div id="profile-screen" class="screen hidden">
        <h2><i class="fas fa-user"></i> <span data-i18n="profile">Profile</span></h2>

        <!-- üîπ Login / Logout goes here -->
        <div id="profile-auth"></div>

        <!-- üîπ Profile content -->
        <div id="profile-content" class="scroll-box"></div>

        <button class="btn-secondary" onclick="showMenu()">
            <i class="fas fa-home"></i> <span data-i18n="back">Back</span>
        </button>
    </div>

    <!-- ============ GAME OVER ============ -->
    <div id="game-over-screen" class="screen hidden">
        <h2><i class="fas fa-flag-checkered"></i> <span data-i18n="game_over">Game Over</span></h2>

        <div class="score-box" style="text-align: center; margin: 20px 0;">
            <span style="font-size: 1.2rem; display: block; margin-bottom: 5px;"><i class="fas fa-star"></i> <span data-i18n="score">Score</span></span>
            <span id="final-score" style="font-size: 3rem; font-weight: bold; color: #4CAF50;">0</span>
        </div>

        <!-- Game Statistics -->
        <div id="game-stats" style="margin: 20px 0;"></div>

        <div id="promos-won-container"></div>

        <button class="btn-primary" onclick="showMenu()">
            <i class="fas fa-home"></i> <span data-i18n="main_menu">Main Menu</span>
        </button>
    </div>
</div>

<!-- Scripts -->
<script src="{% static 'js/utils.js' %}"></script>
<script src="{% static 'js/sounds.js' %}"></script>
<script src="{% static 'js/api.js' %}"></script>
<script src="{% static 'js/ui.js' %}"></script>
<script src="{% static 'js/game.js' %}"></script>
<script src="{% static 'js/main.js' %}"></script>

<script>
// Toggle instructions modal
function toggleInstructions() {
    const modal = document.getElementById('instructions-modal');
    modal.classList.toggle('hidden');
}
</script>

</body>
</html>